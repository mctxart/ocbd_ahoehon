<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>月を呑むへび</title>
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.min.js"></script>
    <style>
        /* ========== グローバルスタイル ========== */
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            font-family: sans-serif;
        }

        body {
            background: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* ========== パスワード入力画面 ========== */
        #password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }

        #password-overlay input {
            padding: 10px;
            font-size: 1.2rem;
            border-radius: 5px;
            border: none;
            margin-top: 15px;
            text-align: center;
        }

        #password-overlay button {
            margin-top: 15px;
            padding: 10px 20px;
            cursor: pointer;
            background: #555;
            color: white;
            border: none;
            border-radius: 5px;
        }

        /* ========== ローディング画面 ========== */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            color: white;
            font-size: 1.5rem;
        }

        .loading-spinner {
            margin-top: 30px;
            width: 50px;
            height: 50px;
            border: 4px solid #444;
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-message {
            margin-top: 30px;
            font-size: 0.9rem;
            color: #aaa;
            text-align: center;
            line-height: 1.4;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* ========== 絵本コンテナ ========== */
        .container {
            display: none;
            width: 90vw;
            height: 90vh;
            justify-content: center;
            align-items: center;
            background: #333;
            padding: 30px;
            box-sizing: border-box;
        }

        @media (orientation: landscape) {
            .container {
                width: 95vw;
                height: 90vh;
                padding: 15px 15px 50px;
            }
        }

        #my-book {
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            touch-action: none;
            overflow: hidden;
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1500px;
            transform-style: preserve-3d;
        }

        /* ========== ページスタイル ========== */
        .page {
            background-color: #fffbf5;
            overflow: hidden;
            position: relative;
            will-change: transform;
            backface-visibility: visible;
            -webkit-backface-visibility: visible;
            margin: 0;
            padding: 0;
            transform-style: preserve-3d;
            /* ソフトな外側の影でページが浮いて見えるようにする */
            box-shadow: 0 8px 18px rgba(0,0,0,0.12);
            border-radius: 2px;
            transition: box-shadow 200ms ease;
        }

        .page img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            mix-blend-mode: multiply;
            filter: sepia(5%) contrast(95%) saturate(95%);
            will-change: transform;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            image-rendering: -webkit-optimize-contrast;
        }

        .white-page {
            background-color: #fffbf5;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        /* ページの質感表現 */
        .page::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png');
            opacity: 0.3;
            /* 内側の微かな陰影でページの厚みを表現 */
            box-shadow: inset 0 30px 40px rgba(0,0,0,0.04), inset 0 -30px 40px rgba(0,0,0,0.03);
            mix-blend-mode: soft-light;
        }

        /* ========== 横向き時の調整 ========== */
        @media (orientation: landscape) {
            #password-overlay,
            #loading-overlay {
                padding: 20px;
                overflow-y: auto;
            }

            #password-overlay h2 {
                margin: 10px 0;
                font-size: 1.2rem;
            }

            #password-overlay input {
                margin-top: 10px;
                font-size: 1rem;
            }

            #password-overlay button {
                margin-top: 10px;
                padding: 8px 15px;
            }

            #loading-overlay p {
                margin: 10px 0;
                font-size: 1.2rem;
            }

            .loading-spinner {
                margin-top: 15px;
                width: 40px;
                height: 40px;
                border: 3px solid #444;
                border-top: 3px solid white;
            }

            .loading-message {
                margin-top: 15px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>

<div id="password-overlay">
    <h2>合言葉を設定してください</h2>
    <input type="password" id="password-input">
    <button onclick="checkPassword()">読み始める</button>
    <p id="error-msg" style="color: #ff6b6b; margin-top: 10px;"></p>
</div>

<div id="loading-overlay" style="display: none;">
    <p>読み込んでいます...</p>
    <div class="loading-spinner"></div>
    <div class="loading-message">タブレットおすすめです！<br>(スマホだと画面からはみ出るかもしれん..)</div>
</div>

<div class="container" id="book-container">
    <div id="my-book">
        <div class="page"><img src="image/omote.jpeg"></div>
        <div class="page"><div class="white-page"></div></div>
        <div class="page"><img src="image/0_タイトル.jpeg"></div>
        <div class="page"><img src="image/1.jpeg"></div>
        <div class="page"><img src="image/2.jpeg"></div>
        <div class="page"><img src="image/3.jpeg"></div>
        <div class="page"><img src="image/4.jpeg"></div>
        <div class="page"><img src="image/5.jpeg"></div>
        <div class="page"><img src="image/6.jpeg"></div>
        <div class="page"><img src="image/7.jpeg"></div>
        <div class="page"><img src="image/8.jpeg"></div>
        <div class="page"><img src="image/9.jpeg"></div>
        <div class="page"><img src="image/10.jpeg"></div>
        <div class="page"><img src="image/11.jpeg"></div>
        <div class="page"><img src="image/12.jpeg"></div>
        <div class="page"><img src="image/13.jpeg"></div>
        <div class="page"><img src="image/14.jpeg"></div>
        <div class="page"><img src="image/15.jpeg"></div>
        <div class="page"><img src="image/16.jpeg"></div>
        <div class="page"><img src="image/17.jpeg"></div>
        <div class="page"><img src="image/18.jpeg"></div>
        <div class="page"><img src="image/19.jpeg"></div>
        <div class="page"><img src="image/20.jpeg"></div>
        <div class="page"><img src="image/21.jpeg"></div>
        <div class="page"><img src="image/22.jpeg"></div>
        <div class="page"><img src="image/okutsuki.jpeg"></div>
        <div class="page"><div class="white-page"></div></div>
        <div class="page"><img src="image/ura.jpeg"></div>
    </div>
</div>

<script>
    const PASSWORD = "60";
    const PAGE_FLIP_CONFIG = {
        width: 600,
        height: 600,
        size: "stretch",
        minWidth: 315,
        maxWidth: 1400,
        minHeight: 315,
        maxHeight: 1400,
        margin: 10,
        drawShadow: true,
        flippingTime: 1000,
        startPage: 0,
        showCover: true,
        usePortrait: true,
        maxShadowOpacity: 0.5,
        mobileScrollSupport: true,
        backGroundColor: "transparent",
        disableFlipByClick: false
    };

    /**
     * パスワードチェックと絵本初期化
     */
    function checkPassword() {
        const input = document.getElementById('password-input').value;
        const errorMsg = document.getElementById('error-msg');

        if (input === PASSWORD) {
            document.getElementById('password-overlay').style.display = 'none';
            document.getElementById('loading-overlay').style.display = 'flex';
            document.getElementById('book-container').style.display = 'flex';
            initBook();
        } else {
            errorMsg.innerText = "合言葉が違います。";
        }
    }

    /**
     * 画像の読み込み完了を待つ
     */
    function waitForImagesLoaded(callback) {
        const images = document.querySelectorAll('.page img');
        let loadedCount = 0;
        const totalCount = images.length;

        if (totalCount === 0) {
            callback();
            return;
        }

        images.forEach(img => {
            const onLoadComplete = () => {
                loadedCount++;
                if (loadedCount === totalCount) {
                    callback();
                }
            };

            if (img.complete) {
                onLoadComplete();
            } else {
                img.addEventListener('load', onLoadComplete);
                img.addEventListener('error', onLoadComplete);
            }
        });
    }

    /**
     * 絵本を初期化
     */
    function initBook() {
        const container = document.getElementById('book-container');
        const padding = 40;
        
        // コンテナサイズに基づいて、絵本の最大サイズを動的に調整
        const maxAvailableWidth = container.clientWidth - padding * 2;
        const maxAvailableHeight = container.clientHeight - padding * 2;
        
        PAGE_FLIP_CONFIG.maxWidth = maxAvailableWidth;
        PAGE_FLIP_CONFIG.maxHeight = maxAvailableHeight;
        
        const pageFlip = new St.PageFlip(
            document.getElementById('my-book'),
            PAGE_FLIP_CONFIG
        );

        pageFlip.loadFromHTML(document.querySelectorAll('.page'));

        // すべての画像読み込み完了時にローディング画面を非表示
        waitForImagesLoaded(() => {
            document.getElementById('loading-overlay').style.display = 'none';
        });

        // タッチスクロール防止
        document.getElementById('my-book').addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
    }
</script>
</body>
</html>
